---
// å·å¡åŠç†å¹¿å‘Šä½ç»„ä»¶
export interface Props {
  cardType?: string;
  description?: string;
  buttonText?: string;
  buttonLink?: string;
  backgroundColor?: string;
  textColor?: string;
  closeable?: boolean;
  urgent?: boolean;
  proCode?: string;
  groupNumber?: string;
}

const {
  cardType = "å¤§æµé‡æ‰‹æœºå¡åŠç†",
  description = "è¶…å¤§æµé‡ å®æƒ æœˆç§Ÿ å®˜æ–¹åˆä½œ å…è´¹åŒ…é‚®",
  buttonText = "ç«‹å³åŠç†",
  buttonLink = "https://ck.nxqingxian.cn/s/IaCZjm4K",
  backgroundColor = "bg-gradient-to-r from-red-500 to-orange-500",
  textColor = "text-white",
  closeable = true,
  urgent = true,
  proCode = "èµ é€ä¸€ä¸ªæœˆ Fideo Pro æ¿€æ´»ç ",
  groupNumber = "QQç¾¤: 1012142357"
} = Astro.props;
---

<div id="adBanner" class={`fixed top-0 left-0 right-0 w-full ${backgroundColor} ${textColor} py-2 px-4 z-[100] shadow-lg`}>
  <div class="max-w-7xl mx-auto">
    <div class="flex items-center justify-between">
      <!-- å¹¿å‘Šå†…å®¹ -->
      <div class="flex items-center space-x-2 md:space-x-4 flex-1">
        <!-- é—ªçƒå›¾æ ‡ -->
        {urgent && (
          <div class="flex-shrink-0">
            <span class="animate-pulse text-yellow-300 text-lg">ğŸ”¥</span>
          </div>
        )}
        
        <!-- ä¸»è¦ä¿¡æ¯ -->
        <div class="flex-1">
          <div class="flex flex-col md:flex-row md:items-center md:space-x-4">
            <!-- å·å¡åç§°å’Œä¼˜æƒ  -->
            <div class="flex items-center space-x-2">
              <span class="font-bold text-sm md:text-base">{cardType}</span>
            </div>
            
            <!-- å¥—é¤è¯¦æƒ… -->
            <div class="flex items-center space-x-3 text-xs md:text-sm">
              <span class="flex items-center">
                <span class="font-semibold ml-1 text-yellow-200">{description}</span>
              </span>
            </div>
            
            <!-- æ–°å¢ç¦åˆ©ä¿¡æ¯ -->
            <div class="flex flex-col md:flex-row md:items-center md:space-x-3 text-xs mt-1 md:mt-0">
              <div class="flex items-center space-x-1">
                <span class="text-yellow-300">ğŸ</span>
                <span class="text-yellow-200 font-medium">{proCode}</span>
              </div>
              <div class="flex items-center space-x-1">
                <span class="text-blue-300">ğŸ‘¥</span>
                <span class="text-blue-200 font-medium">{groupNumber}</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- è¡ŒåŠ¨æŒ‰é’® -->
        <div class="flex items-center space-x-2">
          <a
            id="adBannerButton"
            href={buttonLink}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-white text-red-600 px-3 py-1.5 md:px-6 md:py-2 rounded-full text-xs md:text-sm font-bold hover:bg-yellow-100 transition-all duration-200 whitespace-nowrap shadow-lg transform hover:scale-105"
          >
            {buttonText}
          </a>
          
          <!-- ç´§æ€¥æç¤º -->
          {urgent && (
            <span class="hidden md:block text-xs opacity-90 animate-pulse">
              é™æ—¶ä¼˜æƒ !
            </span>
          )}
        </div>
      </div>
      
    </div>
  </div>
</div>

<script>
  function updateHeaderPosition() {
    const adBanner = document.getElementById('adBanner');
    const header = document.querySelector('header');
    
    if (adBanner && header) {
      const bannerHeight = adBanner.offsetHeight;
      header.style.top = `${bannerHeight}px`;
    }
  }
  
  // åˆå§‹åŒ–ä½ç½®
  document.addEventListener('DOMContentLoaded', () => {
    // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿æ‰€æœ‰ç»„ä»¶éƒ½å·²æ¸²æŸ“
    setTimeout(updateHeaderPosition, 100);
  });
  
  // ç›‘å¬çª—å£å¤§å°å˜åŒ–
  window.addEventListener('resize', updateHeaderPosition);
  
  // å…³é—­æŒ‰é’®åŠŸèƒ½
  const closeBanner = document.getElementById('closeBanner');
  const adBanner = document.getElementById('adBanner');
  
  if (closeBanner && adBanner) {
    closeBanner.addEventListener('click', () => {
      adBanner.style.transform = 'translateY(-100%)';
      document.body.classList.add('ad-banner-closed');
      
      // é‡æ–°è°ƒæ•´æ‰€æœ‰å…ƒç´ ä½ç½®
      setTimeout(() => {
        const header = document.querySelector('header');
        
        if (header) {
          header.style.top = '0px';
        }
      }, 300); // ç­‰å¾…åŠ¨ç”»å®Œæˆ
      
      // ä¿å­˜å…³é—­çŠ¶æ€åˆ° localStorage
      localStorage.setItem('adBannerClosed', 'true');
    });
  }
  
  // Clarity åŸ‹ç‚¹å‡½æ•°
  function trackClarityEvent(eventName: string, eventData: Record<string, any> = {}) {
    if (typeof window !== 'undefined' && (window as any).clarity) {
      (window as any).clarity('event', eventName, eventData);
    }
  }
  
  // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬
  document.addEventListener('DOMContentLoaded', () => {
    const adButton = document.getElementById('adBannerButton') as HTMLAnchorElement;
    
    if (adButton) {
      adButton.addEventListener('click', (event) => {
        // å‘é€ Clarity åŸ‹ç‚¹
        trackClarityEvent('ad_banner_click', {
          button_text: adButton.textContent?.trim() || '',
          button_url: adButton.href,
          timestamp: new Date().toISOString(),
          user_agent: navigator.userAgent,
          page_url: window.location.href
        });
        
        // å¯é€‰ï¼šæ·»åŠ æ§åˆ¶å°æ—¥å¿—ç”¨äºè°ƒè¯•
        console.log('Ad banner button clicked - Clarity event sent');
      });
    }
  });
</script>

<style>
  #adBanner {
    /* ç¡®ä¿å¹¿å‘Šä½åœ¨æœ€é¡¶å±‚ */
    z-index: 100;
  }
  
  /* æ·»åŠ ä¸€äº›åŠ¨ç”»æ•ˆæœ */
  @keyframes shimmer {
    0% { background-position: -200px 0; }
    100% { background-position: calc(200px + 100%) 0; }
  }
  
  .shimmer {
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    background-size: 200px 100%;
    animation: shimmer 2s infinite;
  }
</style>